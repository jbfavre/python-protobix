Description: Skip unit tests when running as root
 On unit test check failure when providing a log file where user has no write privileges.
 Running the test suite as root makes the test to fail
Author: Jean Baptiste Favre <debian@jbfavre.org>
Forwarded: https://github.com/jbfavre/python-protobix/pull/41
Applied-Upstream: https://github.com/jbfavre/python-protobix/commit/c3c95c56ba1282641466190f5eb615ddcd01a54b
Last-Update: 2022-06-15
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/tests/test_sampleprobe.py
+++ b/tests/test_sampleprobe.py
@@ -335,6 +335,7 @@ Check logger configuration in file mode
 Here, invalid means that it doesn't exists, or we don't have
 permission to write into
 """
+@pytest.mark.skipif(os.getuid() == 0, reason="requires non-root user")
 def test_log_file_invalid():
     pbx_test_probe = ProtobixTestProbe()
     pbx_test_probe._init_logging()
--- a/pytest.ini
+++ b/pytest.ini
@@ -1,2 +1,2 @@
 [pytest]
-addopts='-k-_need_backend'
+addopts=-k 'not _need_backend'
--- a/tests/__init__.py
+++ b/tests/__init__.py
@@ -13,7 +13,7 @@ try:
 except ImportError:
     pylint_options = []
 
-pytest_options = ['-v', '-k-_need_backend']
+pytest_options = ['-v']
 pytest_options += coverage_options
 pytest_options += pylint_options
 
